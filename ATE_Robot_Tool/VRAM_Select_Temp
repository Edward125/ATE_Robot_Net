        Dim ws As DBS_42.DBConnectSoapClient = New DBS_42.DBConnectSoapClient  '定义TW DB
        Dim SQLstr As String = String.Empty
        Dim Mo_Str As String
        On Error Resume Next

        If Thd_VRAM_SN = "" Then Exit Sub

        '先查SN的MO
        SQLstr = "select mo from sfcpcb230.sfcusn where usn='" & Thd_VRAM_SN & "'"
        Mo_Str = ws.ExecuteScalar(SQLstr)

        Thd_VRAM_SMode = "Find_Mo"  '查方式

        '如果查工翁箦e,查完成,清除Error退出
        If Err.Number <> 0 Then
            Thd_VRAM_Mat = "Error"
            Thd_VRAM_St = True
            Err.Clear()
            Exit Sub
        End If

        '如果Mo榭崭None,否t附新Mo
        If Mo_Str = "" Then
            Thd_SN_Mo = ""
            Thd_VRAM_Mat = "None"
            Thd_VRAM_St = True
            Exit Sub
        End If

        '工翁相同使用上一次的VRAM料功能K退出
        If Mo_Str = Thd_SN_Mo And Thd_VRAM_Mat <> "" And Thd_VRAM_Mat <> "Error" Then
            Thd_VRAM_St = True
            Exit Sub
        End If

        '如果查到的MO不同,K查VRAM料
        If Mo_Str <> Thd_SN_Mo Then
            Thd_SN_Mo = Mo_Str

            '通^SN查的VRAM料
            SQLstr = "select a.cpn from sfcpcb230.VRAMmaterial a,"
            SQLstr = SQLstr & "sfcpcb230.sfcerpmoitem b,sfcpcb230.sfcusn c where c.usn='"
            SQLstr = SQLstr & Thd_VRAM_SN & "' and c.mo=b.mo and a.cpn=b.cpn"
            Thd_VRAM_Mat = ws.ExecuteScalar(SQLstr)

            Thd_VRAM_SMode = "Find_Mat"  '查方式

            '如果查有e`,e`,清除e`K退出
            If Err.Number <> 0 Then
                Thd_VRAM_Mat = "Error"
                Err.Clear()
                Exit Sub
            End If
            Thd_VRAM_St = True
        End If